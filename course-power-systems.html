<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מתקנים ומערכות הספק - מיכאל אסייג</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Heebo', sans-serif; }
        .accordion { border: 1px solid #e2e8f0; border-radius: 0.5rem; overflow: hidden; }
        .accordion details { border-bottom: 1px solid #e2e8f0; }
        .accordion details:last-child { border-bottom: none; }

        /* Style for the main accordion level (e.g., Mahat/Education) */
        .accordion > details > summary { list-style: none; cursor: pointer; padding: 1rem; font-weight: 600; display: flex; align-items: center; background-color: #f7fafc;}

        /* FIX: Ensure the default browser marker (the "half full head") is hidden for all summaries */
        .accordion summary {
            list-style: none; /* Already present in the line above, but good for redundancy */
        }
        .accordion summary::-webkit-details-marker,
        .accordion summary::marker {
            display: none;
        }

        .accordion summary::before { content: ''; display: inline-block; width: 0.5rem; height: 0.5rem; border-style: solid; border-width: 0 2px 2px 0; border-color: #4a5568; margin-left: 0.75rem; transform: rotate(45deg); transition: transform 0.2s ease-in-out; }
        .accordion details[open] > summary::before { transform: rotate(-135deg); }
        .accordion .accordion-content-wrapper { overflow: hidden; }
        .accordion .accordion-content { padding: 1rem; background-color: #ffffff; border-top: 1px solid #e2e8f0; }
        /* Styling for the nested accordions (e.g., Handasaim/Technaim) */
        .accordion .accordion-content details { border-radius: 0.375rem; border: 1px solid #e2e8f0; }
        .accordion .accordion-content > details:not(:last-child) { margin-bottom: 0.5rem; }
        /* Styling for the deepest nested accordions (Year Grouping) */
        .accordion .accordion-content details details { margin-bottom: 0.25rem; }
        .accordion .accordion-content details summary { background-color: #edf2f7; font-weight: 500; }
        .accordion .accordion-content details details summary { background-color: #f7f9fb; font-weight: 400; padding: 0.75rem 1rem; }
        .accordion .accordion-content .accordion-content { padding-top: 0.5rem; padding-bottom: 0.5rem; }
    </style>
</head>
<body class="bg-gray-50" text="gray-800">

<header class="bg-white shadow-md sticky top-0 z-20">
    <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
        <div class="text-2xl font-bold text-gray-900"><a href="index.html">מיכאל אסייג</a></div>
        <div>
            <a href="index.html" class="text-gray-600 hover:text-blue-600 px-3 py-2">אודות</a>
            <a href="courses.html" class="text-blue-600 font-semibold px-3 py-2">קורסים</a>
            <a href="background-for-engineers.html" class="text-gray-600 hover:text-blue-600 px-3 py-2">רקע להנדסאים</a>
            <a href="publications.html" class="text-gray-600 hover:text-blue-600 px-3 py-2">פרסומים</a>
            <a href="contact.html" class="text-gray-600 hover:text-blue-600 px-3 py-2">יצירת קשר</a>
        </div>
    </nav>
</header>

<main>
    <section class="bg-blue-700 text-white">
        <div class="container mx-auto px-6 py-16 text-center">
            <h1 class="text-4xl md:text-5xl font-bold">מתקנים ומערכות הספק</h1>
            <p class="text-lg md:text-xl mt-4 text-blue-200">תכנון, הגנה ותחזוקה של מתקני חשמל וניתוח מערכות הספק.</p>
            <a href="courses.html" class="mt-8 inline-flex items-center text-white font-semibold hover:underline">
                <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 12h14"></path></svg>
                <span>חזרה לכל הקורסים</span>
            </a>
        </div>
    </section>

    <section class="py-12 md:py-20">
        <div class="container mx-auto px-6 space-y-10">

            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">קבצים שימושיים ותכניות לימוד</h2>
                <div class="accordion">
                    <details>
                        <summary>תכניות לימוד</summary>
                        <div class="accordion-content-wrapper"><div class="accordion-content" id="curriculum"></div></div>
                    </details>
                    <details>
                        <summary>קבצים שימושיים</summary>
                        <div class="accordion-content-wrapper"><div class="accordion-content" id="useful-files"></div></div>
                    </details>
                </div>
            </div>

            <!-- מבחנים חיצוניים (External Exams) -->
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">מבחנים חיצוניים</h2>
                <div class="accordion">
                    <details>
                        <summary>מה"ט</summary>
                        <div class="accordion-content-wrapper"><div class="accordion-content space-y-4">
                            <details>
                                <summary>הנדסאים</summary>
                                <div class="accordion-content-wrapper"><div class="accordion-content" id="exams-mahat-handasaim">
                                    <div class="space-y-2 mb-4">
                                        <input type="text" id="exams-mahat-handasaim-search" placeholder="חפש מבחן לפי שם..." class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <div id="exams-mahat-handasaim-year-select-wrapper" class="flex items-center space-x-2 space-x-reverse">
                                            <label for="exams-mahat-handasaim-year-select" class="text-sm font-medium text-gray-700 whitespace-nowrap">סנן לפי שנה:</label>
                                            <select id="exams-mahat-handasaim-year-select" class="w-full px-4 py-2 border rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-blue-500"></select>
                                        </div>
                                    </div>
                                    <!-- Dynamic content (year accordions) will be injected here by JS -->
                                </div></div>
                            </details>
                            <details>
                                <summary>טכנאים</summary>
                                <div class="accordion-content-wrapper"><div class="accordion-content" id="exams-mahat-technaim">
                                    <div class="space-y-2 mb-4">
                                        <input type="text" id="exams-mahat-technaim-search" placeholder="חפש מבחן לפי שם..." class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <div id="exams-mahat-technaim-year-select-wrapper" class="flex items-center space-x-2 space-x-reverse">
                                            <label for="exams-mahat-technaim-year-select" class="text-sm font-medium text-gray-700 whitespace-nowrap">סנן לפי שנה:</label>
                                            <select id="exams-mahat-technaim-year-select" class="w-full px-4 py-2 border rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-blue-500"></select>
                                        </div>
                                    </div>
                                    <!-- Dynamic content (year accordions) will be injected here by JS -->
                                </div></div>
                            </details>
                        </div></div>
                    </details>
                    <details>
                        <summary>משרד החינוך</summary>
                        <div class="accordion-content-wrapper"><div class="accordion-content space-y-4">
                            <details>
                                <summary>הנדסאים</summary>
                                <div class="accordion-content-wrapper"><div class="accordion-content" id="exams-education-handasaim">
                                    <div class="space-y-2 mb-4">
                                        <input type="text" id="exams-education-handasaim-search" placeholder="חפש מבחן לפי שם..." class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <div id="exams-education-handasaim-year-select-wrapper" class="flex items-center space-x-2 space-x-reverse">
                                            <label for="exams-education-handasaim-year-select" class="text-sm font-medium text-gray-700 whitespace-nowrap">סנן לפי שנה:</label>
                                            <select id="exams-education-handasaim-year-select" class="w-full px-4 py-2 border rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-blue-500"></select>
                                        </div>
                                    </div>
                                    <!-- Dynamic content (year accordions) will be injected here by JS -->
                                </div></div>
                            </details>
                            <details>
                                <summary>טכנאים</summary>
                                <div class="accordion-content-wrapper"><div class="accordion-content" id="exams-education-technaim">
                                    <div class="space-y-2 mb-4">
                                        <input type="text" id="exams-education-technaim-search" placeholder="חפש מבחן לפי שם..." class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <div id="exams-education-technaim-year-select-wrapper" class="flex items-center space-x-2 space-x-reverse">
                                            <label for="exams-education-technaim-year-select" class="text-sm font-medium text-gray-700 whitespace-nowrap">סנן לפי שנה:</label>
                                            <select id="exams-education-technaim-year-select" class="w-full px-4 py-2 border rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-blue-500"></select>
                                        </div>
                                    </div>
                                    <!-- Dynamic content (year accordions) will be injected here by JS -->
                                </div></div>
                            </details>
                        </div></div>
                    </details>
                </div>
            </div>

            <!-- פתרונות למבחנים חיצוניים (External Exam Solutions) -->
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">פתרונות למבחנים חיצוניים</h2>
                <div class="accordion">
                    <details>
                        <summary>מה"ט</summary>
                        <div class="accordion-content-wrapper"><div class="accordion-content space-y-4">
                            <details>
                                <summary>הנדסאים</summary>
                                <div class="accordion-content-wrapper"><div class="accordion-content" id="solutions-mahat-handasaim">
                                    <div class="space-y-2 mb-4">
                                        <input type="text" id="solutions-mahat-handasaim-search" placeholder="חפש פתרון לפי שם..." class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <div id="solutions-mahat-handasaim-year-select-wrapper" class="flex items-center space-x-2 space-x-reverse">
                                            <label for="solutions-mahat-handasaim-year-select" class="text-sm font-medium text-gray-700 whitespace-nowrap">סנן לפי שנה:</label>
                                            <select id="solutions-mahat-handasaim-year-select" class="w-full px-4 py-2 border rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-blue-500"></select>
                                        </div>
                                    </div>
                                    <!-- Dynamic content (year accordions) will be injected here by JS -->
                                </div></div>
                            </details>
                            <details>
                                <summary>טכנאים</summary>
                                <div class="accordion-content-wrapper"><div class="accordion-content" id="solutions-mahat-technaim">
                                    <div class="space-y-2 mb-4">
                                        <input type="text" id="solutions-mahat-technaim-search" placeholder="חפש פתרון לפי שם..." class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <div id="solutions-mahat-technaim-year-select-wrapper" class="flex items-center space-x-2 space-x-reverse">
                                            <label for="solutions-mahat-technaim-year-select" class="text-sm font-medium text-gray-700 whitespace-nowrap">סנן לפי שנה:</label>
                                            <select id="solutions-mahat-technaim-year-select" class="w-full px-4 py-2 border rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-blue-500"></select>
                                        </div>
                                    </div>
                                    <!-- Dynamic content (year accordions) will be injected here by JS -->
                                </div></div>
                            </details>
                        </div></div>
                    </details>
                    <details>
                        <summary>משרד החינוך</summary>
                        <div class="accordion-content-wrapper"><div class="accordion-content space-y-4">
                            <details>
                                <summary>הנדסאים</summary>
                                <div class="accordion-content-wrapper"><div class="accordion-content" id="solutions-education-handasaim">
                                    <div class="space-y-2 mb-4">
                                        <input type="text" id="solutions-education-handasaim-search" placeholder="חפש פתרון לפי שם..." class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <div id="solutions-education-handasaim-year-select-wrapper" class="flex items-center space-x-2 space-x-reverse">
                                            <label for="solutions-education-handasaim-year-select" class="text-sm font-medium text-gray-700 whitespace-nowrap">סנן לפי שנה:</label>
                                            <select id="solutions-education-handasaim-year-select" class="w-full px-4 py-2 border rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-blue-500"></select>
                                        </div>
                                    </div>
                                    <!-- Dynamic content (year accordions) will be injected here by JS -->
                                </div></div>
                            </details>
                            <details>
                                <summary>טכנאים</summary>
                                <div class="accordion-content-wrapper"><div class="accordion-content" id="solutions-education-technaim">
                                    <div class="space-y-2 mb-4">
                                        <input type="text" id="solutions-education-technaim-search" placeholder="חפש פתרון לפי שם..." class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <div id="solutions-education-technaim-year-select-wrapper" class="flex items-center space-x-2 space-x-reverse">
                                            <label for="solutions-education-technaim-year-select" class="text-sm font-medium text-gray-700 whitespace-nowrap">סנן לפי שנה:</label>
                                            <select id="solutions-education-technaim-year-select" class="w-full px-4 py-2 border rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-blue-500"></select>
                                        </div>
                                    </div>
                                    <!-- Dynamic content (year accordions) will be injected here by JS -->
                                </div></div>
                            </details>
                        </div></div>
                    </details>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">חומרי לימוד</h2>
                <div class="accordion">
                    <details>
                        <summary>הנדסאים</summary>
                        <div class="accordion-content-wrapper"><div class="accordion-content" id="study-materials-handasaim"></div></div>
                    </details>
                    <details>
                        <summary>טכנאים</summary>
                        <div class="accordion-content-wrapper"><div class="accordion-content" id="study-materials-technaim"></div></div>
                    </details>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-2xl font-bold text-gray-900 mb-2">שאלות לתרגול</h2>
                <p class="text-gray-600 mb-6">קבצי תרגול לפי נושאים, כולל פתרונות מודרכים.</p>
                <div class="accordion">
                    <details>
                        <summary>מה"ט</summary>
                        <div class="accordion-content-wrapper"><div class="accordion-content space-y-4">
                            <details>
                                <summary>הנדסאים</summary>
                                <div class="accordion-content-wrapper"><div class="accordion-content" id="practice-mahat-handasaim"></div></div>
                            </details>
                            <details>
                                <summary>טכנאים</summary>
                                <div class="accordion-content-wrapper"><div class="accordion-content" id="practice-mahat-technaim"></div></div>
                            </details>
                        </div></div>
                    </details>
                    <details>
                        <summary>משרד החינוך</summary>
                        <div class="accordion-content-wrapper"><div class="accordion-content space-y-4">
                            <details>
                                <summary>הנדסאים</summary>
                                <div class="accordion-content-wrapper"><div class="accordion-content" id="practice-education-handasaim"></div></div>
                            </details>
                            <details>
                                <summary>טכנאים</summary>
                                <div class="accordion-content-wrapper"><div class="accordion-content" id="practice-education-technaim"></div></div>
                            </details>
                        </div></div>
                    </details>
                </div>
            </div>

        </div>
    </section>
</main>

<footer class="bg-gray-800 text-white py-8">
    <div class="container mx-auto px-6 text-center">
        <p>&copy; 2025 מיכאל אסייג. כל הזכויות שמורות.</p>
    </div>
</footer>

<script>
    // --- START OF DYNAMIC CONTENT LOGIC ---

    const SPREADSHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQTaNkP0Rqwf-UzVt2H-T9Rk6L8YsQ3PFn7mXrTUoV8I08yyVikLzXcmopasIfUaS5-OXRQbQ49tqLl/pub?output=csv';
    const CURRENT_COURSE_ID = 'power';
    let allCourseFiles = [];
    const containerIDs = [
        'curriculum', 'useful-files',
        'exams-mahat-handasaim', 'exams-mahat-technaim', 'exams-education-handasaim', 'exams-education-technaim',
        'solutions-mahat-handasaim', 'solutions-mahat-technaim', 'solutions-education-handasaim', 'solutions-education-technaim',
        'study-materials-handasaim', 'study-materials-technaim',
        'practice-mahat-handasaim', 'practice-mahat-technaim', 'practice-education-handasaim', 'practice-education-technaim'
    ];

    // List of categories that should be grouped by Year and have a Year Select filter
    const YEAR_GROUPED_CATEGORIES = [
        'exams-mahat-handasaim', 'exams-mahat-technaim', 'exams-education-handasaim', 'exams-education-technaim',
        'solutions-mahat-handasaim', 'solutions-mahat-technaim', 'solutions-education-handasaim', 'solutions-education-technaim'
    ];

    // 1. Function for generating a simple file list (reused inside year accordions)
    function generateFileList(files) {
        if (!files || files.length === 0) {
            return '<p class="text-gray-500">אין קבצים להצגה כרגע.</p>';
        }
        return files.map(file => `
                <a href="${file.url}" target="_blank" rel="noopener noreferrer" class="flex items-center justify-between p-3 rounded-md hover:bg-blue-50 text-blue-600">
                    <span>${file.title}</span>
                    <span class="bg-blue-500 text-white text-sm font-semibold px-3 py-1 rounded-full hover:bg-blue-600 transition-colors">פתיחה</span>
                </a>
            `).join('');
    }

    // 2. Function to extract year from title
    function extractYear(title) {
        // Look for 4 digits that are likely a year (19xx or 20xx)
        const match = title.match(/\b(19\d{2}|20\d{2})\b/);
        return match ? match[0] : 'שונות'; // 'Miscellaneous'
    }

    // 3. Function to generate the year-grouped accordion content
    function generateYearAccordion(files) {
        if (!files || files.length === 0) {
            return '<p class="text-gray-500">לא נמצאו קבצים תואמים לחיפוש זה.</p>';
        }

        const filesByYear = files.reduce((acc, file) => {
            const year = extractYear(file.title);
            if (!acc[year]) { acc[year] = []; }
            acc[year].push(file);
            return acc;
        }, {});

        // Sort years in descending order (newest first), keeping 'שונות' last
        const sortedYears = Object.keys(filesByYear).sort((a, b) => {
            if (a === 'שונות') return 1;
            if (b === 'שונות') return -1;
            return parseInt(b) - parseInt(a);
        });

        // Generate the HTML for the year accordions
        return sortedYears.map(year => {
            const yearFiles = filesByYear[year];
            const content = generateFileList(yearFiles);

            return `
                <details>
                    <summary>שנה: ${year}</summary>
                    <div class="accordion-content-wrapper">
                        <div class="accordion-content space-y-2">
                            ${content}
                        </div>
                    </div>
                </details>
            `;
        }).join('');
    }

    // 4. New function to handle both text and year filtering and rendering
    function applyFiltersAndRender(id, allFiles) {
        const searchInput = document.getElementById(`${id}-search`);
        const selectInput = document.getElementById(`${id}-year-select`);
        const dynamicContentContainer = document.querySelector(`#${id} .content-container-dynamic`);

        if (!dynamicContentContainer) return;

        const searchText = searchInput ? searchInput.value.toLowerCase() : '';
        const selectedYear = selectInput ? selectInput.value : 'all'; // Default to 'all'

        // 1. Apply Text Filter
        let filteredFiles = allFiles.filter(file =>
            file.title.toLowerCase().includes(searchText)
        );

        // 2. Apply Year Filter (only if a specific year is selected)
        if (selectedYear !== 'all') {
            filteredFiles = filteredFiles.filter(file => {
                return extractYear(file.title) === selectedYear;
            });
        }

        // 3. Render
        dynamicContentContainer.innerHTML = generateYearAccordion(filteredFiles);

        // Re-apply the accordion logic to the newly rendered details elements
        dynamicContentContainer.querySelectorAll('details').forEach((el) => {
            new Accordion(el);
        });
    }

    // 5. New function to populate the year select dropdown and attach listeners
    function populateYearSelectAndAttachListeners(id, allFiles) {
        const selectInput = document.getElementById(`${id}-year-select`);
        if (!selectInput) return;

        const uniqueYears = new Set();
        allFiles.forEach(file => {
            uniqueYears.add(extractYear(file.title));
        });

        // Convert Set to Array and sort descending (except 'שונות')
        const sortedYears = Array.from(uniqueYears).sort((a, b) => {
            if (a === 'שונות') return 1;
            if (b === 'שונות') return -1;
            return parseInt(b) - parseInt(a);
        });

        let optionsHtml = '<option value="all">-- כל השנים --</option>';
        sortedYears.forEach(year => {
            optionsHtml += `<option value="${year}">${year}</option>`;
        });

        selectInput.innerHTML = optionsHtml;

        // Attach listeners for both inputs to the central filtering function
        const boundFilterAndRender = () => applyFiltersAndRender(id, allFiles);

        const searchInput = document.getElementById(`${id}-search`);
        if (searchInput) {
            searchInput.addEventListener('input', boundFilterAndRender);
        }
        selectInput.addEventListener('change', boundFilterAndRender);
    }

    async function fetchAndRenderData() {
        try {
            const response = await fetch(SPREADSHEET_URL);
            if (!response.ok) { throw new Error('Network response was not ok'); }
            const csvText = await response.text();

            const cleanCell = (cell) => {
                if (typeof cell !== 'string') return '';
                let cleaned = cell.trim();
                if (cleaned.startsWith('"') && cleaned.endsWith('"')) {
                    cleaned = cleaned.substring(1, cleaned.length - 1);
                }
                return cleaned.replace(/""/g, '"');
            };

            const rows = csvText.split(/\r?\n/).map(row => row.split(','));
            const headers = rows.shift();

            // Map data and filter for the current course
            allCourseFiles = rows.map(row => ({
                title: cleanCell(row[0]),
                url: cleanCell(row[1]),
                category: cleanCell(row[2]),
                course: cleanCell(row[3])
            })).filter(file => file.course === CURRENT_COURSE_ID && file.title && file.url); // Ensure title and url exist

            const filesByCategory = {};
            allCourseFiles.forEach(file => {
                if (file.category) {
                    const category = file.category.trim();
                    if (!filesByCategory[category]) {
                        filesByCategory[category] = [];
                    }
                    filesByCategory[category].push(file);
                }
            });

            // Iterate over all container IDs to render files
            containerIDs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    const filesToRender = filesByCategory[id] || [];

                    // Logic for Year Grouped Categories (Exams and Solutions)
                    if (YEAR_GROUPED_CATEGORIES.includes(id)) {

                        // 1. Create a container for the dynamic content (year accordions)
                        const dynamicContentContainer = document.createElement('div');
                        dynamicContentContainer.classList.add('content-container-dynamic', 'space-y-4', 'mt-4'); // Added mt-4 for spacing

                        // Initial render (shows all files)
                        dynamicContentContainer.innerHTML = generateYearAccordion(filesToRender);

                        // 2. Insert the dynamic content after the search/select wrapper
                        const searchWrapper = element.querySelector('.mb-4');
                        if (searchWrapper) {
                            searchWrapper.after(dynamicContentContainer);
                        } else {
                            // Fallback if search wrapper not found
                            element.appendChild(dynamicContentContainer);
                        }

                        // 3. Populate the year select box and attach listeners
                        populateYearSelectAndAttachListeners(id, filesToRender);

                        // 4. Apply accordion behavior to initial render
                        dynamicContentContainer.querySelectorAll('details').forEach((el) => {
                            new Accordion(el);
                        });

                    } else {
                        // Logic for Flat Categories (Curriculum, Useful Files, Study, Practice)
                        const filesContainer = document.createElement('div');
                        filesContainer.classList.add('space-y-2');
                        filesContainer.innerHTML = generateFileList(filesToRender);
                        element.appendChild(filesContainer);
                    }

                } else {
                    console.warn(`HTML element with id "${id}" not found.`);
                }
            });

        } catch (error) {
            console.error('Error fetching or parsing spreadsheet data:', error);
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        fetchAndRenderData();
    });

    // --- ACCORDION ANIMATION CLASS ---
    class Accordion {
        constructor(el) {
            this.el = el;
            this.summary = el.querySelector('summary');
            this.content = el.querySelector('.accordion-content-wrapper');
            if (!this.summary || !this.content) return; // Guard against incomplete elements

            this.animation = null;
            this.isClosing = false;
            this.isExpanding = false;

            // Check if the listener is already attached to prevent duplicates on re-render
            if (!this.el.hasAttribute('data-accordion-init')) {
                this.summary.addEventListener('click', (e) => this.onClick(e));
                this.el.setAttribute('data-accordion-init', 'true');
            }
        }
        onClick(e) {
            e.preventDefault();
            this.el.style.overflow = 'hidden';
            if (this.isClosing || !this.el.open) { this.open(); }
            else if (this.isExpanding || this.el.open) { this.shrink(); }
        }
        shrink() {
            this.isClosing = true;
            const startHeight = `${this.el.offsetHeight}px`;
            const endHeight = `${this.summary.offsetHeight}px`;
            if (this.animation) { this.animation.cancel(); }
            this.animation = this.el.animate({ height: [startHeight, endHeight] }, { duration: 300, easing: 'ease-out' });
            this.animation.onfinish = () => this.onAnimationFinish(false);
            this.animation.oncancel = () => this.isClosing = false;
        }
        open() {
            this.el.style.height = `${this.el.offsetHeight}px`;
            this.el.open = true;
            window.requestAnimationFrame(() => this.expand());
        }
        expand() {
            this.isExpanding = true;
            // The content height is calculated dynamically on open
            const startHeight = `${this.el.offsetHeight}px`;
            // Must check if content exists before calculating height
            const contentHeight = this.content ? this.content.offsetHeight : 0;
            const endHeight = `${this.summary.offsetHeight + contentHeight}px`;

            if (this.animation) { this.animation.cancel(); }
            this.animation = this.el.animate({ height: [startHeight, endHeight] }, { duration: 300, easing: 'ease-out' });
            this.animation.onfinish = () => this.onAnimationFinish(true);
            this.animation.oncancel = () => this.isExpanding = false;
        }
        onAnimationFinish(open) {
            this.el.open = open;
            this.animation = null;
            this.isClosing = false;
            this.isExpanding = false;
            this.el.style.height = this.el.style.overflow = '';
        }
    }

    // Initial application of the accordion class (will also be called after search filtering)
    document.querySelectorAll('details').forEach((el) => { new Accordion(el); });

</script>
</body>
</html>
